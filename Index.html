<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.855">
    <title>Appointment Scheduler</title>
    <style>
        /* Your CSS styling */
    </style>
</head>
<body>
    <!-- Your HTML content -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

        // Firebase configuration for Vierven project
        const viervenConfig = {
            apiKey: "AIzaSyCWLHVHlMV0WfKIu_p2mlOMNcHJ3823-P4",
            authDomain: "vierven-35def.firebaseapp.com",
            projectId: "vierven-35def",
            storageBucket: "vierven-35def.appspot.com",
            messagingSenderId: "301018782509",
            appId: "1:301018782509:web:2ee0c6b723f08b75b691a4",
            measurementId: "G-S7PEPBBJT8"
        };

        // Firebase configuration for Pros project
        const prosConfig = {
            apiKey: "AIzaSyDj9jveAfZTrn0SKNpCD02NMAxtjGjfhiU",
            authDomain: "pros-48631.firebaseapp.com",
            projectId: "pros-48631",
            storageBucket: "pros-48631.appspot.com",
            messagingSenderId: "314909182040",
            appId: "1:314909182040:web:5c8b3f2f980aa9fb4de22d",
            measurementId: "G-D4SXCZLFNP"
        };

        let viervenApp, viervenDb;
        let prosApp, prosStorage, auth;

        function initializeFirebase() {
            viervenApp = initializeApp(viervenConfig, 'viervenApp');
            viervenDb = getFirestore(viervenApp);

            prosApp = initializeApp(prosConfig, 'prosApp');
            prosStorage = getStorage(prosApp);
            auth = getAuth(prosApp);
        }

        initializeFirebase();

        // Ensure the user is authenticated before uploading
        signInAnonymously(auth).catch(error => {
            console.error('Error during anonymous sign-in:', error);
        });

        onAuthStateChanged(auth, user => {
            if (user) {
                console.log('User signed in:', user);
            } else {
                console.error('User is signed out');
            }
        });

        document.getElementById('appointment-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const startTime = document.getElementById('start_time').value;
            const endTime = document.getElementById('end_time').value;

            await addDoc(collection(viervenDb, 'appointments'), {
                title: title,
                description: description,
                start_time: startTime,
                end_time: endTime,
                created_at: new Date().toISOString()
            });

            document.getElementById('appointment-form').reset();
            loadAppointments();
        });

        document.getElementById('image-upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const file = document.getElementById('image').files[0];
            if (!file) {
                console.error("No file selected for upload");
                return;
            }

            try {
                const user = auth.currentUser;
                if (!user) {
                    throw new Error('User not authenticated');
                }

                const storageRef = ref(prosStorage, 'images/' + file.name);
                await uploadBytes(storageRef, file);
                const url = await getDownloadURL(storageRef);
                console.log('Image uploaded successfully! URL:', url);
                alert('Image uploaded successfully! URL: ' + url);
            } catch (error) {
                console.error("Error uploading image:", error);
                alert('Failed to upload image. Check the console for errors.');
            }

            document.getElementById('image-upload-form').reset();
        });

        async function loadAppointments() {
            const table = document.getElementById('appointments-table');
            table.innerHTML = `
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                </tr>
            `;

            try {
                const q = query(collection(viervenDb, 'appointments'), orderBy('start_time'));
                const snapshot = await getDocs(q);
                snapshot.forEach(doc => {
                    const appointment = doc.data();
                    const row = table.insertRow();
                    row.insertCell(0).innerText = appointment.title;
                    row.insertCell(1).innerText = appointment.description;
                    row.insertCell(2).innerText = new Date(appointment.start_time).toLocaleString();
                    row.insertCell(3).innerText = new Date(appointment.end_time).toLocaleString();
                });
            } catch (error) {
                console.error("Error loading appointments:", error);
            }
        }

        window.onload = loadAppointments;
    </script>
</body>
</html>
