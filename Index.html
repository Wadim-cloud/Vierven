<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.855">
    <title>Appointment Scheduler</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            position: relative; /* To position the carousel in the top-right corner */
        }
        .carousel-container {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 41px;
            height: 100px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 2px solid #000; /* Border to match the rest of the frames */
            background-color: #fff; /* Background color for contrast */
        }
        .carousel {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .carousel img {
            width: 41px;
            height: 100px;
            object-fit: cover;
        }
        .frames-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .random-frame, .timed-frame {
            width: 41px;
            height: 41px;
            border: 2px solid #000;
            overflow: hidden;
            background-color: #fff;
            margin-bottom: 10px; /* Spacing between the two frames */
        }
        .random-frame img, .timed-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .reshuffle-button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: #fff;
            transition: background-color 0.3s ease;
        }
        .reshuffle-button:hover {
            background-color: #0056b3;
        }
        /* Green tint effect */
        .green-tint {
            filter: hue-rotate(90deg) saturate(2);
        }
        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('background-image.jpg') no-repeat center center fixed; /* Example background image */
            background-size: cover;
            z-index: -1;
        }
        .content {
            z-index: 1;
        }
    </style>
</head>
<body>

    <div class="background"></div>
    <div class="content">
        <h1>Vierven™</h1>
        <p>We bewegen onze polsen aan de hand van een kwast en een oppervlak</p>
        <p>Het licht geeft ons werk een tint</p>
        <p>Smaken, kleuren en geuren</p>
        <p>En als het werk gedaan is ruimen we alles op.</p>
        <p>Houd rekening met €500,-</p>
        <button type="button" onclick="alert('+31684074565')">Telefoon</button>

        <!-- Appointment Scheduler -->
        <h2>Appointment Scheduler</h2>
        <form id="appointment-form">
            <label for="title">Title:</label>
            <input type="text" name="title" id="title" required>
            <label for="description">Description:</label>
            <input type="text" name="description" id="description">
            <label for="start_time">Start Time:</label>
            <input type="datetime-local" name="start_time" id="start_time" required>
            <label for="end_time">End Time:</label>
            <input type="datetime-local" name="end_time" id="end_time" required>
            <button type="submit">Add Appointment</button>
        </form>

        <!-- Image Upload -->
        <h2>Upload Image to Pros Storage</h2>
        <form id="image-upload-form">
            <label for="image">Choose Image:</label>
            <input type="file" name="image" id="image" accept="image/*" required>
            <button type="submit">Upload Image</button>
        </form>

        <!-- Display Appointments -->
        <h3>Upcoming Appointments</h3>
        <table id="appointments-table">
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Start Time</th>
                <th>End Time</th>
            </tr>
        </table>
    </div>

    <div class="carousel-container" id="carousel-container">
        <div class="carousel" id="carousel">
            <!-- Images will be inserted here by JavaScript -->
        </div>
    </div>

    <div class="frames-container">
        <div class="random-frame" id="random-frame">
            <img id="random-image" alt="Random Image">
        </div>
        <div class="timed-frame" id="timed-frame">
            <img id="timed-image" alt="Timed Image">
        </div>
    </div>

    <div class="button-container">
        <button class="reshuffle-button" onclick="reshuffleRandomImage()">Reshuffle</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

        // Firebase configuration for Vierven project
        const viervenConfig = {
            apiKey: "private",
            authDomain: "vierven-35def.firebaseapp.com",
            projectId: "vierven-35def",
            storageBucket: "vierven-35def.appspot.com",
            messagingSenderId: "301018782509",
            appId: "1:301018782509:web:2ee0c6b723f08b75b691a4",
            measurementId: "G-S7PEPBBJT8"
        };

        // Firebase configuration for Pros project
        const prosConfig = {
            apiKey: "AIzaSyDj9jveAfZTrn0SKNpCD02NMAxtjGjfhiU",
            authDomain: "pros-48631.firebaseapp.com",
            projectId: "pros-48631",
            storageBucket: "pros-48631.appspot.com",
            messagingSenderId: "314909182040",
            appId: "1:314909182040:web:5c8b3f2f980aa9fb4de22d",
            measurementId: "G-D4SXCZLFNP"
        };

        let viervenApp, viervenDb;
        let prosApp, prosStorage, auth;

        function initializeFirebase() {
            viervenApp = initializeApp(viervenConfig, 'viervenApp');
            viervenDb = getFirestore(viervenApp);

            prosApp = initializeApp(prosConfig, 'prosApp');
            prosStorage = getStorage(prosApp);
            auth = getAuth(prosApp);
        }

        initializeFirebase();

        // Ensure the user is authenticated before uploading
        signInAnonymously(auth).catch(error => {
            console.error('Error during anonymous sign-in:', error);
        });

        onAuthStateChanged(auth, user => {
            if (user) {
                console.log('User signed in:', user);
            } else {
                console.error('User is signed out');
            }
        });

        document.getElementById('appointment-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const startTime = document.getElementById('start_time').value;
            const endTime = document.getElementById('end_time').value;

            await addDoc(collection(viervenDb, 'appointments'), {
                title: title,
                description: description,
                start_time: startTime,
                end_time: endTime,
                created_at: new Date().toISOString()
            });

            document.getElementById('appointment-form').reset();
            loadAppointments();
        });

        document.getElementById('image-upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const file = document.getElementById('image').files[0];
            if (!file) {
                console.error("No file selected for upload");
                return;
            }

            try {
                const user = auth.currentUser;
                if (!user) {
                    throw new Error('User not authenticated');
                }

                const storageRef = ref(prosStorage, 'images/' + file.name);
                await uploadBytes(storageRef, file);
                const url = await getDownloadURL(storageRef);
                console.log('Image uploaded successfully! URL:', url);
                alert('Image uploaded successfully! URL: ' + url);
            } catch (error) {
                console.error("Error uploading image:", error);
                alert('Failed to upload image. Check the console for errors.');
            }

            document.getElementById('image-upload-form').reset();
        });

        async function loadAppointments() {
            const table = document.getElementById('appointments-table');
            table.innerHTML = `
                <tr>
                    <th>Title</th>
                    <th>Description</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                </tr>
            `;

            try {
                const q = query(collection(viervenDb, 'appointments'), orderBy('start_time'));
                const snapshot = await getDocs(q);
                snapshot.forEach(doc => {
                    const appointment = doc.data();
                    const row = table.insertRow();
                    row.insertCell(0).innerText = appointment.title;
                    row.insertCell(1).innerText = appointment.description;
                    row.insertCell(2).innerText = new Date(appointment.start_time).toLocaleString();
                    row.insertCell(3).innerText = new Date(appointment.end_time).toLocaleString();
                });
            } catch (error) {
                console.error("Error loading appointments:", error);
            }
        }

        // Carousel logic
        const images = [
            'canvas1.png',
            'canvas2.png',
            'canvas3.png',
            'canvas4.png'
        ];

        const carousel = document.getElementById('carousel');
        const randomImage = document.getElementById('random-image');
        const timedImage = document.getElementById('timed-image');
        const carouselContainer = document.getElementById('carousel-container');
        const randomFrame = document.getElementById('random-frame');
        const timedFrame = document.getElementById('timed-frame');
        let currentIndex = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
        }

        function populateCarousel() {
            shuffleArray(images); // Shuffle images before adding to carousel
            images.forEach(image => {
                const img = document.createElement('img');
                img.src = image;
                img.alt = 'Carousel Image';
                carousel.appendChild(img);
            });
        }

        function showNextImage() {
            currentIndex = (currentIndex + 1) % images.length;
            carousel.style.transform = `translateX(-${currentIndex * 41}px)`; // Updated to 41px width
        }

        function updateRandomImage() {
            const randomIndex = Math.floor(Math.random() * images.length);
            randomImage.src = images[randomIndex];
        }

        function updateTimedImage() {
            const timedIndex = Math.floor(Math.random() * images.length);
            timedImage.src = images[timedIndex];
        }

        function reshuffleRandomImage() {
            updateRandomImage(); // Update the random image when reshuffle button is clicked
        }

        function applyGreenTint() {
            // Remove green tint from all frames
            carouselContainer.classList.remove('green-tint');
            randomFrame.classList.remove('green-tint');
            timedFrame.classList.remove('green-tint');

            // Randomly select one of the three frames to apply the green tint
            const randomFrameToTint = Math.floor(Math.random() * 3);
            switch (randomFrameToTint) {
                case 0:
                    carouselContainer.classList.add('green-tint');
                    break;
                case 1:
                    randomFrame.classList.add('green-tint');
                    break;
                case 2:
                    timedFrame.classList.add('green-tint');
                    break;
            }
        }

        // Initialize the carousel
        populateCarousel();
        showNextImage();
        updateRandomImage();
        updateTimedImage();

        // Set intervals for automatic transitions
        setInterval(showNextImage, 2000); // Change carousel image every 2 seconds
        setInterval(updateRandomImage, 2000); // Update random image every 2 seconds
        setInterval(updateTimedImage, 10000); // Update timed image every 10 seconds
        setInterval(applyGreenTint, 15000); // Apply green tint to a random frame every 15 seconds

        window.onload = loadAppointments;
    </script>

</body>
</html>
